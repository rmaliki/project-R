---
title: 'Allianz: projet d''entretien'
author: "Rochd MALIKI"
date: "24 aoÃfÂ»t 2017"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Préambule

Ce document s'agit d'une analyse statistique des sinistres corporel de l'année 2015. 

#### Chargement des librairies

```{r message=F}
library("ggplot2")
library("caret")
#library("randomForest")


```
#### Importation des données
```{r message=FALSE}
# Reading datasets
characteristics<-read.csv("Données/caracteristiques_2015.csv")
locations<-read.csv("Données/lieux_2015.csv")
users<-read.csv("Données/usagers_2015.csv")
vehicle<-read.csv("Données/vehicules_2015.csv")
```
## Gravité des accidents
On définit la gravité des accidents à partir de l'attribut "grav" de la base de données [usagers_2015.csv](Données/usagers_2015.csv) en changeant la caractérisation à 2 niveaux ('Pas grave', 'Grave'), au lieu de 4 niveaux ('Indemne', 'Blessé leger', 'Blessé hospitalisé', 'Tué'), la classe 'Grave' remplace ('Tué','Blessé hospitalisé') et 'Pas grave' remplace ('Indemne', 'Blessé leger')
### Visualisation de la gravité en  foction de la tranche d'age
```{r message=F}
newus<-users[,c("an_nais","grav")]
newus$grav=factor(newus$grav)
levels(newus$grav)=c("Pas grave","Grave","Grave","Pas grave")
require(scales)
p<-ggplot(newus, aes(2015-an_nais,fill=grav))+geom_histogram(data = newus, aes(x=2015-an_nais,fill=grav),position="fill",binwidth =10,color='white')+ ylab("Pourcentage") +xlab("Age")
library("plotly")
palet_couleur<-c('#520202','#21B6A8')
names(palet_couleur)<-c("Grave","Pas grave")
p<-p+scale_fill_manual(name="accidents",values = palet_couleur)+scale_y_continuous(labels = scales::percent)
p<-ggplotly(p)
p%>%layout(paper_bgcolor='transparent',plot_bgcolor='transparent',bargap=10,yaxis=list(tickformat='%'))

```

### Gravité et catégorie du vehicule
```{r}
df<-merge(users, vehicle)
df$grav=factor(df$grav)
levels(df$grav)=c("Pas grave","Grave","Grave","Pas grave")
df$grav=factor(df$grav)
df$catu=factor(df$catu,labels = c("Conducteur","Passager","Piéton ","Piéton en roller"))
qplot(an_nais,catv,data=df,color=grav,xlim =c(1925,2005))
```



## Including Plots

You can also embed plots, for example:

```{r  echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
